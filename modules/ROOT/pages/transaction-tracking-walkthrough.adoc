= Transaction Tracking Walkthrough
ifndef::env-site,env-github[]
include::_attributes.adoc[]
endif::[]
:keywords: b2b, tracking

include::partial$include-v1-eol.adoc[]


== Audience

This document is aimed at a technical audience possessing basic knowledge of Anypoint Studio and Anypoint B2B.

== Prerequisites

* Anypoint Studio with Mule Server 3.7.1 EE runtime
* Anypoint Platform account
* Amazon S3 bucket for file storage (optional)

== Running the Example

. Import this example into Anypoint Studio:
+
[source,xml,linenums]
----
<?xml version="1.0"?>
<PurchaseOrder PurchaseOrderNumber="00003" OrderDate="2015-05-13">
  <TotalPrice>188.93</TotalPrice>
  <Address>
    <Name>Stocked.com</Name>
    <Street>123 Maple Street</Street>
    <City>Mill Valley</City>
    <State>CA</State>
    <Zip>10999</Zip>
    <Country>USA</Country>
  </Address>
  <Items>
    <Item PartNumber="3421-MB">
      <ProductName>Ladies Jacket MED BLACK</ProductName>
      <Quantity>1</Quantity>
      <USPrice>148.95</USPrice>
      <ShipDate>2015-05-20</ShipDate>
    </Item>
    <Item PartNumber="4421-MB">
      <ProductName>Ladies Base layer MED BLACK</ProductName>
      <Quantity>1</Quantity>
      <USPrice>39.98</USPrice>
      <ShipDate>2015-05-20</ShipDate>
    </Item>
  </Items>
</PurchaseOrder>
----
+
. From your web browser, log into Anypoint Partner Manager. Go to the Home Organization page and copy your secret API key.
. From the imported Mule project in Anypoint Studio, click the file `b2b-tracking-transmission.xml` in the `app` folder, and select the *Global Elements* view tab. Open the Partner Manager Connector configuration and set the API Key you generated from Anypoint Partner Manager.
. Right-click  the imported project folder from the *Project Explorer* view. Select *Run As* and click *Mule Application*.
. Create a copy of the file `po.xml` in `src/test/resources` and place it in the `outbox` directory
. The file should disappear from the directory since the File Connector message source  deletes the file after it reads it.
. Access the B2B Transmissions page in the Anypoint Partner Manager to confirm that the B2B exchange was tracked.

== Anypoint B2B Platform Transaction Tracking Walkthrough

This walkthrough shows you how to leverage the Anypoint B2B Platform to track B2B exchanges for non-EDI messages and connectors that are not included in Anypoint B2B. In this walkthrough you will develop a Mule application that simulates a B2B exchange of a XML purchase order. The application will read a purchase order file from a directory in your local filesystem and save it to another directory. In between, the exchange, in terms of metadata, message content and other data, will be tracked using the Partner Manager Connector. Once tracked, the exchange can be viewed from the Anypoint Partner Manager.

. Launch Anypoint Studio and create a new Mule project.
. Switch to the *Global Elements* view and create a Partner Manager Connector configuration.
. Go back to the *Message Flow* view. Drag the *File Connector* from the palette to the canvas in order to create a message source:
+
image::transmission-tracking-walk-1.png[]

. Configure the *File Connector* message source to read from a directory called `outbox`:
+
image::transmission-tracking-walk-2.png[]

. Add an *Object to String* transformer after the message source in order to read from the file stream:
+
image::transmission-tracking-walk-3.png[]

. Drag the *Partner Manager Connector* from the palette and add it to the flow:
+
image::transmission-tracking-walk-4.png[]

. Select as *Connector Configuration* the config that you created in step 2. Select *Track transmission* for the *operation*:
+
image::transmission-tracking-walk-5.png[]

. Configure the *Track transmission* operation as follows:
+
[%autowidth.spread]
|===
|*Field* |*Value*
|From-party identifier|`#[xpath3(''/PurchaseOrder/Address/Name'')`]
|To-party identifier|`My Organization`
|Content Reference (Set only if you have configured the File Storage type on the Partner Manager Connector config)|`#[payload]`
|Filename|`#[flowVars.originalFilename]`
|Format Type|`XML`
|===
+
image::transmission-tracking-walk-6.png[]
+
In addition to the above, click on Create Object manually which is located next to the *Metadata* attribute. This action brings up the *Object Builder* that allows you to define the metadata to be saved as part of the transmission. Define the metadata entries as shown in the screenshot below:
+
image::transmission-tracking-walk-7.png[]

. Add a *File Connector* to the flow such that the purchase order is written out to a different directory called `inbox`:
+
image::transmission-tracking-walk-8.png[]

. Right-click the project and run the application as a Mule project:
+
image::transmission-tracking-walk-9.png[]
+
If you have enabled S3 storage in the Partner Manager Connector config, then you need to add the AWS and S3 parameters to the Mule application VM arguments.

. Put the example XML listed in <<Running the Example>> in the `outbox` directory. You should see the file moved to the `inbox` directory.
. Access the Anypoint Partner Manager and go to the B2B transmissions view to confirm that the exchange was tracked:
+
image::transmission-tracking-walk-10.png[]
